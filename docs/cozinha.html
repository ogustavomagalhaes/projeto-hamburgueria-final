<!DOCTYPE html>
<html lang="pt-br">
<head>
    <!-- Meta tags Obrigatórias -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <!-- Font Awesome (opcional, mas bom para manter o padrão ) -->
    <script src="https://kit.fontawesome.com/621ba70d5e.js" crossorigin="anonymous"></script>

    <!-- Estilo customizado -->
    <link rel="stylesheet" type="text/css" href="./css/estilo.css">

    <title>Painel da Cozinha - Pedidos</title>

    <style>
        /* Estilos específicos da página da cozinha */
        .card-body { font-size: 0.9rem; }
        .card-header { font-weight: bold; }
        .card-pedido-pronto .card-header { background-color: #28a745 !important; color: white; } /* Verde para pedidos prontos */
    </style>
</head>
<body>
    
    <header> <!-- INICIO DO TOPO (COPIADO DA INDEX) -->
        <nav id="navegacao" class="navbar navbar-expand-md navbar-light">
            <div class="container">
                <!-- LOGO -->
                <a class="navbar-brand" href="index.html">
                    <img src="imagens/logo-fundo.png" alt="logo" width="150">
                </a>

                <!-- BOTÃO (para telas pequenas) -->
                <button class="navbar-toggler" data-toggle="collapse" data-target="#menu-principal">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- MENU DE NAVEGAÇÃO -->
                <div class="collapse navbar-collapse" id="menu-principal">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item">
                            <a class="nav-link font-weight-bold" href="index.html">Cadastrar</a>
                        </li>
                        <li class="nav-item">
                            <!-- O link "Consulta" agora está ativo nesta página -->
                            <a class="nav-link active font-weight-bold" href="cozinha.html">Consulta</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header> <!-- FIM TOPO -->

    <!-- Conteúdo principal da página da Cozinha -->
    <main class="container mt-4 mb-5">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h1>Painel da Cozinha</h1>
            <button id="atualizarBtn" class="btn btn-primary">
                <i class="fas fa-sync-alt"></i> Atualizar Pedidos
            </button>
        </div>
        
        <!-- Os cards dos pedidos serão inseridos aqui pelo JavaScript -->
        <div id="pedidos-container" class="row">
            <!-- Carregando pedidos... -->
        </div>
    </main>

    <!-- Scripts do Bootstrap (necessários para o menu responsivo) -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <!-- Script para carregar os pedidos (seu código original, sem alterações ) -->
    <script>
        async function carregarPedidos() {
            try {
                const response = await fetch('/api/pedidos');
                if (!response.ok) throw new Error('Falha ao buscar pedidos');
                
                const pedidos = await response.json();
                const container = document.getElementById('pedidos-container');
                container.innerHTML = '';

                if (pedidos.length === 0) {
                    container.innerHTML = '<p class="col-12">Nenhum pedido recebido ainda.</p>';
                    return;
                }

                // Inverte a lista para mostrar os pedidos mais recentes primeiro
                pedidos.reverse().forEach(pedido => {
                    const card = document.createElement('div');
                    card.className = 'col-md-4 mb-4';

                    const detalhesCombos = pedido.detalhes_combos.map(combo => 
                        `<li><strong>Combo ${combo.combo_numero}:</strong> ${combo.ingredientes.join(', ')}, ${combo.ponto_carne}, ${combo.bebida}</li>`
                    ).join('');

                    card.innerHTML = `
                        <div class="card">
                            <div class="card-header bg-warning text-dark">
                                Pedido #${pedido.id} - ${pedido.nome}
                            </div>
                            <div class="card-body">
                                <p><strong>Telefone:</strong> ${pedido.telefone}</p>
                                <p><strong>Local:</strong> ${pedido.local_consumo}</p>
                                <p><strong>Pagamento:</strong> ${pedido.forma_pagamento}</p>
                                <hr>
                                <h6>Combos:</h6>
                                <ul>${detalhesCombos}</ul>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });

            } catch (error) {
                console.error('Erro:', error);
                container.innerHTML = '<p class="col-12 text-danger">Não foi possível carregar os pedidos.</p>';
            }
        }

        document.getElementById('atualizarBtn').addEventListener('click', carregarPedidos);
        document.addEventListener('DOMContentLoaded', carregarPedidos);
    </script>
</body>
</html>
